<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BliKins Messenger</title>
    <style>
        /* --- –°–¢–ò–õ–Ü (CSS) --- */
        :root {
            --bg-color: #0e1621;
            --sidebar-bg: #17212b;
            --text-color: #ffffff;
            --accent-color: #2b5278;
            --input-bg: #242f3d;
        }

        body.light-theme {
            --bg-color: #ffffff;
            --sidebar-bg: #f4f4f5;
            --text-color: #000000;
            --accent-color: #3390ec;
            --input-bg: #ffffff;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è */
        .auth-container {
            background: var(--sidebar-bg);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            width: 350px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        input {
            width: 90%;
            margin: 10px 0;
            padding: 12px;
            background: var(--input-bg);
            border: 1px solid #303030;
            color: var(--text-color);
            border-radius: 8px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: var(--accent-color);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover { opacity: 0.8; }

        /* –ú–µ—Å–µ–Ω–¥–∂–µ—Ä */
        #messenger-app {
            display: none; /* –°—Ö–æ–≤–∞–Ω–æ –¥–æ –≤—Ö–æ–¥—É */
            width: 100%;
            height: 100vh;
            flex-direction: row;
        }

        .sidebar {
            width: 320px;
            background: var(--sidebar-bg);
            border-right: 1px solid rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-window {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
        }

        .chat-header {
            padding: 15px;
            background: var(--sidebar-bg);
            font-weight: bold;
            border-bottom: 1px solid rgba(0,0,0,0.2);
        }

        #messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .input-area {
            padding: 15px;
            background: var(--sidebar-bg);
            display: flex;
            gap: 10px;
        }

        /* –ë–æ–∫–æ–≤–µ –º–µ–Ω—é */
        #side-menu {
            position: fixed;
            left: -300px;
            top: 0;
            width: 280px;
            height: 100%;
            background: var(--sidebar-bg);
            transition: 0.3s;
            z-index: 100;
            padding: 20px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }

        #side-menu.active { left: 0; }

        .user-info img { border-radius: 50%; margin-bottom: 10px; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="auth-screen" class="auth-container">
        <h2 id="auth-title">–í—Ö—ñ–¥ BliKins</h2>
        <input type="text" id="login-email" placeholder="Email (–Ω–∞–ø—Ä. user@bk.com)">
        <input type="password" id="login-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        
        <div id="reg-extra" class="hidden">
            <input type="password" id="login-pass-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
            <input type="text" id="secret-code" placeholder="–°–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–æ–¥">
        </div>

        <button id="auth-btn" onclick="handleAuth()">–£–≤—ñ–π—Ç–∏</button>
        <p style="cursor:pointer; font-size: 14px; margin-top: 15px;" onclick="toggleReg()">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</p>
    </div>

    <div id="messenger-app">
        <div id="side-menu">
            <div class="user-info">
                <img id="my-avatar" src="https://via.placeholder.com/60" width="60" height="60">
                <h3 id="my-name">–õ–æ–≥—ñ–Ω</h3>
                <p>Pepe Coins: <span id="my-pepe">0</span> üê∏</p>
            </div>
            <hr>
            <button onclick="alert('–ü—Ä–æ—Ñ—ñ–ª—å —É —Ä–æ–∑—Ä–æ–±—Ü—ñ')">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</button>
            <button onclick="toggleTheme()">üåì –ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É</button>
            <button id="admin-btn" class="hidden" style="background: darkred;">üõ°Ô∏è –ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</button>
            <br>
            <button onclick="location.reload()" style="background: #444;">–í–∏–π—Ç–∏</button>
        </div>

        <div class="sidebar">
            <div class="sidebar-header">
                <span style="cursor:pointer; font-size: 24px;" onclick="toggleMenu()">‚ò∞</span>
                <input type="text" placeholder="–ü–æ—à—É–∫ –ª—é–¥–µ–π/–∫–∞–Ω–∞–ª—ñ–≤...">
                <button style="width: 40px;">‚úé</button>
            </div>
            <div id="chat-list">
                <div style="padding: 15px; display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05);">
                    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" width="40">
                    <div>
                        <strong>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ ‚úÖ</strong>
                        <div style="font-size: 12px; color: gray;">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ!</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-window">
            <div class="chat-header" id="chat-name">–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –±–æ—Ç</div>
            <div id="messages">
                <div style="background: var(--accent-color); padding: 10px; border-radius: 10px; max-width: 70%; margin-bottom: 10px;">
                    –ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π –ø–æ–º—ñ—á–Ω–∏–∫ BliKins. –¢—É—Ç –±—É–¥—É—Ç—å —Ç–≤–æ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
                </div>
            </div>
            <div class="input-area">
                <button style="width: 50px;">üìé</button>
                <input type="text" id="msg-input" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...">
                <button style="width: 80px;" onclick="alert('–í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Å–∫–æ—Ä–æ –∑–∞–ø—Ä–∞—Ü—é—î!')">Send</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // –¢–≤–æ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
        const firebaseConfig = {
            apiKey: "AIzaSyBV3cEHIGsVyCSeNy1eo4ZBj7vhL0f0nHA",
            authDomain: "blikins-23ca8.firebaseapp.com",
            databaseURL: "https://blikins-23ca8-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "blikins-23ca8",
            storageBucket: "blikins-23ca8.firebasestorage.app",
            messagingSenderId: "907805919084",
            appId: "1:907805919084:web:714e2d2b63d738e86c9549"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let isReg = false;

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –í—Ö—ñ–¥/–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
        window.toggleReg = () => {
            isReg = !isReg;
            document.getElementById('reg-extra').classList.toggle('hidden');
            document.getElementById('auth-title').innerText = isReg ? '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è' : '–í—Ö—ñ–¥ BliKins';
            document.getElementById('auth-btn').innerText = isReg ? '–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç' : '–£–≤—ñ–π—Ç–∏';
        };

        // –õ–æ–≥—ñ–∫–∞ –ö–Ω–æ–ø–∫–∏
        window.handleAuth = async () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            const code = document.getElementById('secret-code').value;

            if (isReg) {
                let role = "";
                if (code === "232348") role = "user";
                else if (code === "*?‚Ññ3827428") role = "admin";
                else { alert("–ù–µ–≤—ñ—Ä–Ω–∏–π —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–æ–¥!"); return; }

                try {
                    const res = await createUserWithEmailAndPassword(auth, email, pass);
                    await set(ref(db, 'users/' + res.user.uid), {
                        username: email.split('@')[0],
                        role: role,
                        pepeCoins: 0,
                        avatar: "https://via.placeholder.com/60"
                    });
                    alert("–£—Å–ø—ñ—Ö! –¢–µ–ø–µ—Ä —É–≤—ñ–π–¥—ñ—Ç—å.");
                    location.reload();
                } catch (e) { alert(e.message); }
            } else {
                try {
                    const res = await signInWithEmailAndPassword(auth, email, pass);
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('messenger-app').style.display = 'flex';
                    loadUser(res.user.uid);
                } catch (e) { alert("–ü–æ–º–∏–ª–∫–∞: " + e.message); }
            }
        };

        async function loadUser(uid) {
            const snap = await get(ref(db, 'users/' + uid));
            if (snap.exists()) {
                const data = snap.val();
                document.getElementById('my-name').innerText = data.username;
                document.getElementById('my-pepe').innerText = data.pepeCoins;
                if (data.role === "admin") document.getElementById('admin-btn').classList.remove('hidden');
            }
        }

        window.toggleMenu = () => document.getElementById('side-menu').classList.toggle('active');
        window.toggleTheme = () => document.body.classList.toggle('light-theme');

    </script>
</body>
</html>
